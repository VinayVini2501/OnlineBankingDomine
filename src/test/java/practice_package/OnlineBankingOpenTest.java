package practice_package;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Properties;
import java.util.concurrent.TimeUnit;

import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.ss.usermodel.WorkbookFactory;
import org.openqa.selenium.Alert;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.Select;

public class OnlineBankingOpenTest {

	public static void main(String[] args) throws IOException, InterruptedException
	{
		// Read the data from property file
		FileInputStream fis = new FileInputStream("./src/test/resources/CommonData.properties");
		Properties p = new Properties();
		p.load(fis);
		String url = p.getProperty("url");
		String StaffId =p.getProperty("StaffId");
		String Password1 =p.getProperty("Password1");

		//Enter the Application
		WebDriver driver = new ChromeDriver();
		driver.manage().window().maximize();
		driver.manage().timeouts().implicitlyWait(10,TimeUnit.SECONDS);
		driver.get(url);
		driver.findElement(By.xpath("//li[.='Open Account']")).click();

		// Read data from excel File
		FileInputStream fis1 = new FileInputStream("./src/test/resources/TestData1.xlsx");
		Workbook wb = WorkbookFactory.create(fis1);
		Sheet sh = wb.getSheet("Sheet1");
		Sheet sh1 = wb.getSheet("Sheet2");
		Sheet sh2 = wb.getSheet("CreateAccount");

		// For fields name, mobile,email
		ArrayList<String > list = new ArrayList<String>();
		list.add("name");
		list.add("mobile");
		list.add("email");
		list.add("landline");
		list.add("pan_no");
		list.add("citizenship");
		list.add("homeaddrs");
		list.add("officeaddrs");
		list.add("pin");
		list.add("arealoc");

		for(int i=0; i<=sh.getLastRowNum(); i++)
		{
			String Values = sh.getRow(i).getCell(1).getStringCellValue();
			driver.findElement(By.name(list.get(i))).sendKeys(Values);

		}

		//For date of birth

		driver.findElement(By.xpath("//input[@name='dob']")).click();
		driver.findElement(By.xpath("//input[@name='dob']")).sendKeys("25-01-1995");

		/*WebElement Gender = driver.findElement(By.xpath("//select[@name='gender']"));
		Select s = new Select (Gender);
		s.selectByValue("Male");

		WebElement State = driver.findElement(By.xpath("//select[@name='state']"));
		Select s1 = new Select (State);
		s1.selectByValue("Florida");

		WebElement City = driver.findElement(By.xpath("//select[@name='city']"));
		Select s2 = new Select (City);
		s2.selectByValue("Austin");

		WebElement Type = driver.findElement(By.xpath("//select[@name='acctype']"));
		Select s3 = new Select (Type);
		s3.selectByValue("Saving");*/

		//for fields gender,state,city,accounttype
		ArrayList<String> list1 = new ArrayList<String>();
		list1.add("//select[@name='gender']");
		list1.add("//select[@name='state']");
		list1.add("//select[@name='city']");
		list1.add("//select[@name='acctype']");

		for(int i=0; i<=sh1.getLastRowNum(); i++)
		{
			String Value1 = sh1.getRow(i).getCell(1).getStringCellValue();
			WebElement state = driver.findElement(By.xpath(list1.get(i)));
			Select s1 = new Select(state);
			s1.selectByValue(Value1);
		}

		//click on submit button
		driver.findElement(By.name("submit")).click();


		// Handling allert popup Application number will be genrated  
		// click on the confirm button
		
		driver.findElement(By.xpath("//input[@name='cnfrm-submit']")).click();

		String text = driver.switchTo().alert().getText();
		System.out.println(text);

		char ch[]= text.toCharArray();
		char ch1[]= new char[9];
		int j=0;
		for(int i=0; i<ch.length; i++)
		{
			if(ch[i]>='0' && ch[i]<='9')
			{
				ch1[j]=(ch[i]);
				j++;		
			}

		}
		String str= new String(ch1);
		System.out.println(str);
		driver.switchTo().alert().accept();

		sh2.getRow(1).createCell(1).setCellValue(str);
		FileOutputStream fis2 = new FileOutputStream("./src/test/resources/TestData1.xlsx");
		wb.write(fis2);
		//wb.close();

		// Go to staff login 
		Thread.sleep(2000);

		driver.findElement(By.xpath("//a[.='Staff Login']")).click();

		// Enter the staff id and password click on login button
		driver.findElement(By.name("staff_id")).sendKeys(StaffId);
		driver.findElement(By.name("password")).sendKeys(Password1);
		driver.findElement(By.name("staff_login-btn")).click();



		// click on Approve Pending Account

		driver.findElement(By.name("apprvac")).click();
		driver.findElement(By.name("application_no")).sendKeys(str);
		driver.findElement(By.name("search_application")).click();
		Thread.sleep(2000);
		driver.findElement(By.name("approve_cust")).click();

		// Account number will be genrated 
		String text1 = driver.switchTo().alert().getText();
		System.out.println(text1);

		char ch3[]= text1.toCharArray();
		char ch2[]= new char[13];
		j=0;
		for(int i=0; i<ch3.length; i++)
		{
			if(ch3[i]>='0' && ch3[i]<='9')
			{
				ch2[j]=(ch3[i]);
				j++;		
			}

		}
		String str1= new String(ch2);
		System.out.println(str1);
		driver.switchTo().alert().accept();

		sh2.getRow(2).createCell(1).setCellValue(str1);
		FileOutputStream fos = new FileOutputStream("./src/test/resources/TestData1.xlsx");
		wb.write(fos);
		
		// click on staff home
		driver.findElement(By.name("home")).click();
		driver.findElement(By.name("credit_cust_ac")).click();
		driver.findElement(By.name("customer_account_no")).sendKeys(str1);
		driver.findElement(By.name("credit_amount")).sendKeys("20000");
		driver.findElement(By.name("credit_btn")).click();
		
		driver.switchTo().alert().accept();
		

		//logout as Staff
		driver.findElement(By.name("logout_btn")).click();

		// click on Home button
		driver.findElement(By.xpath("//a[.='Home']")).click();

		// Applay debit card and Enter the Valid Details through Excel data.
		driver.findElement(By.xpath("//li[.='Apply Debit Card']")).click();

		String  name = sh.getRow(0).getCell(1).getStringCellValue();
		String  pan = sh.getRow(4).getCell(1).getStringCellValue();
		String mobno = sh.getRow(1).getCell(1).getStringCellValue();
		String  accno = sh2.getRow(2).getCell(1).getStringCellValue();

		driver.findElement(By.name("holder_name")).sendKeys(name);
		driver.findElement(By.xpath("//input[@name='dob']")).click();
		driver.findElement(By.xpath("//input[@name='dob']")).sendKeys("25-01-1995");
		driver.findElement(By.name("pan")).sendKeys(pan);
		driver.findElement(By.name("mob")).sendKeys(mobno);
		driver.findElement(By.name("acc_no")).sendKeys(accno);
		driver.findElement(By.name("dbt_crd_submit")).click();

		//handling popup notedown the Note the debit card number  and pin and fetch into excel sheet
		Alert dal = driver.switchTo().alert();
		String dbno= dal.getText();
		System.out.println(dbno);

		char dbch[]=dbno.toCharArray();
		String dbtno=" ";
		String pinno=" ";
		int count =0;

		for(int i=0; i<dbch.length; i++)
		{
			if(dbch[i]>='0' && dbch[i]<='9')
			{
				if(count <12)
				{
					dbtno=dbtno+dbch[i];
					count++;
				}
				else
				{
					pinno=pinno+dbch[i];
				}	  
			}
		}
		System.out.println(dbtno);
		System.out.println(pinno);

		driver.switchTo().alert().accept();

		sh2.getRow(3).createCell(1).setCellValue(dbtno);
		sh2.getRow(4).createCell(1).setCellValue(pinno);
		FileOutputStream fos5 = new FileOutputStream("./src/test/resources/TestData1.xlsx");
		wb.write(fos5);

		//Click on home
		driver.findElement(By.xpath("//a[.='Home']")).click();

		//click on internet banking and first Rigister the module 
		Actions a= new Actions(driver);
		WebElement Rigister = driver.findElement(By.xpath("//div[@class='ebanking']"));
		a.moveToElement(Rigister).perform();

		// Rigister the internet banking
		driver.findElement(By.xpath("//li[.='Register']")).click();

		//Enter the proper valid details on registre module

		String  name1 = sh.getRow(0).getCell(1).getStringCellValue();
		String  accno1 = sh2.getRow(2).getCell(1).getStringCellValue();
		String  dbtno1 =sh2.getRow(3).getCell(1).getStringCellValue();
		String  dbpin =sh2.getRow(4).getCell(1).getStringCellValue();
		String mobno1 = sh.getRow(1).getCell(1).getStringCellValue();
		String  pan1 = sh.getRow(4).getCell(1).getStringCellValue();
		driver.findElement(By.xpath("//input[@name='dob']")).click();
		driver.findElement(By.xpath("//input[@name='dob']")).sendKeys("25-01-1995");
		String Ltrsn =sh2.getRow(5).getCell(1).getStringCellValue();
		String  PW =sh2.getRow(6).getCell(1).getStringCellValue();
		String  CPW =sh2.getRow(7).getCell(1).getStringCellValue();

		driver.findElement(By.name("holder_name")).sendKeys(name1);
		driver.findElement(By.name("accnum")).sendKeys(accno1);
		driver.findElement(By.name("dbtcard")).sendKeys(dbtno1);
		driver.findElement(By.name("dbtpin")).sendKeys(dbpin);
		driver.findElement(By.name("mobile")).sendKeys(mobno1);
		driver.findElement(By.name("pan_no")).sendKeys(pan1);
		driver.findElement(By.xpath("//input[@name='dob']")).click();
		driver.findElement(By.xpath("//input[@name='dob']")).sendKeys("25-01-1995");
		driver.findElement(By.name("last_trans")).sendKeys(Ltrsn);
		driver.findElement(By.name("password")).sendKeys(PW);
		driver.findElement(By.name("cnfrm_password")).sendKeys(CPW);

		// click on rigister module submit button
		driver.findElement(By.name("submit")).click();

		// Allert popup should display notedown the customer ID
		String text3 = driver.switchTo().alert().getText();
		System.out.println(text3);


		char ch4[]= text3.toCharArray();
		char ch7[]= new char[7];
		j=0;
		for(int i=0; i<ch4.length; i++)
		{
			if(ch4[i]>='0' && ch4[i]<='9')
			{
				ch7[j]=(ch4[i]);
				j++;		
			}

		}
		String str5= new String(ch7);
		System.out.println(str5);
		driver.switchTo().alert().accept();

		sh2.getRow(8).createCell(1).setCellValue(str5);
		FileOutputStream fos6 = new FileOutputStream("./src/test/resources/TestData1.xlsx");
		wb.write(fos6);

		//Again click on home button Move to mouse pointer to Internetbanking for login purpose

		driver.findElement(By.xpath("//a[.='Home']")).click();

		Actions a1= new Actions(driver);
		WebElement Login1 = driver.findElement(By.xpath("//div[@class='ebanking']"));
		a1.moveToElement(Login1).perform();

		// click on login button
		driver.findElement(By.xpath("//li[.='Login ']")).click();

		// Staff login page should display Enter the proper valid login credentials details

		// enter the customer id and password take from Excel Sheet
		String  CID = sh2.getRow(8).getCell(1).getStringCellValue();
		String  PWCID = sh2.getRow(7).getCell(1).getStringCellValue();

		driver.findElement(By.name("customer_id")).sendKeys(CID);
		driver.findElement(By.xpath("// input[@class='password']")).sendKeys(PWCID);

		// click on login button Customer loginpage page should display
		driver.findElement(By.name("login-btn")).click();

		//Customer login page 5 module is there 1)My account  2)My profile 3) Change Password 4) Fund Transfer 5) Statement

		// Click on Fund Transfer Module Fund Transfer page should display
		// in fund transter 3 module is there 1)Add benificiary 2)Delete benificiary 3)View Benificiary

		driver.findElement(By.xpath("//li[.='Fund Transfer']")).click();

		// Click on Add benificiary Enter the proper valid details
		driver.findElement(By.xpath("//input[@value='Add beneficiary']")).click();

		// Enter the valid proper details in Benificiary page
		driver.findElement(By.name("beneficiary_name")).sendKeys("vinay");
		driver.findElement(By.name("beneficiary_acno")).sendKeys("101121011269");
		driver.findElement(By.name("Ifsc_code")).sendKeys("1011");
		WebElement Saving1 = driver.findElement(By.xpath("//select[@name='beneficiary_acc_type']"));
		Select s2 = new Select(Saving1);
		s2.selectByValue("Saving");
		
		// click on add benificiary button
		driver.findElement(By.xpath("//input[@type='submit']")).click();
		
		// Benificiary add successfully aller popup will display click on ok button
		String text4 = driver.switchTo().alert().getText();
		System.out.println(text4);
		driver.switchTo().alert().accept();
		
		// Again we go for Fundtranfer module Click on Fundtranfer module
		driver.findElement(By.xpath("//li[.='Fund Transfer']")).click();
		WebElement Saving2 = driver.findElement(By.xpath("//select[@name='beneficiary']"));
		Select s3 = new Select(Saving2);
		s3.selectByIndex(1);
		// Enter the Ammount
		driver.findElement(By.name("trnsf_amount")).sendKeys("10000");
		driver.findElement(By.name("trnsf_remark")).sendKeys("Sent");
		driver.findElement(By.name("fnd_trns_btn")).click();
		
		// take otp number and enter the otp number
		String otp = driver.findElement(By.xpath("//label[@class='OTP_msg']")).getText();
		System.out.println(otp);
		
		char chh[]=otp.toCharArray();
		String st12=" ";
		
		int count4=0;
		for(int i= chh.length-1;i>=0; i--)
		{
			if(chh[i]>='0' && chh[i]<='9')
			{
				if(count4<6)
				{
					st12=st12+chh[i];
					count4++;
				}
				else
				{
					
				}
			}
		}
		System.out.println(st12);
		StringBuilder st13 = new StringBuilder(st12);
		st13.reverse();
		System.out.println(st13);
		
		// verify otp
		
		driver.findElement(By.name("otpcode")).sendKeys(st13);
		driver.findElement(By.name("verify-btn")).click();
		
		// click on popup
		String text6 = driver.switchTo().alert().getText();
		System.out.println(text6);
		driver.switchTo().alert().accept();
		
		//	wb.close();
















































	}

}
